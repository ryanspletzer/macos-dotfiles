# =============================================================================
# tmux Configuration
# =============================================================================

# ---------------------------------------------------------------------------
# Core Settings
# ---------------------------------------------------------------------------

# Better terminal type with undercurl + color support (Neovim diagnostics)
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'
set -as terminal-features ',*:RGB'

# Mouse support
set -g mouse on

# Window and pane numbering starts at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# No delay for escape key (important for Neovim)
set -s escape-time 0

# Focus events for Neovim autoread
set -g focus-events on

# Scrollback buffer
set -g history-limit 50000

# Display messages longer
set -g display-time 4000

# Refresh status bar more frequently
set -g status-interval 5

# Clipboard integration
set -g set-clipboard on

# Extended keys (for modifier key sequences)
set -s extended-keys always

# Aggressive resize for grouped sessions
setw -g aggressive-resize on

# Auto-rename windows to show current directory
setw -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# ---------------------------------------------------------------------------
# Prefix
# ---------------------------------------------------------------------------

# Remap prefix from Ctrl+b to Ctrl+a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ---------------------------------------------------------------------------
# Key Bindings
# ---------------------------------------------------------------------------

# Reload config
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes with | and - (using current path)
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# New window with current path
bind c new-window -c "#{pane_current_path}"

# Kill pane without confirmation
bind x kill-pane

# Claude Code 60/40 layout: left=Neovim (60%), right=Claude Code (40%)
bind C split-window -h -p 35 -c "#{pane_current_path}"

# Reorder windows with Ctrl+Alt+Arrow
bind -n C-M-Left swap-window -t -1\; select-window -t -1
bind -n C-M-Right swap-window -t +1\; select-window -t +1

# Pane navigation with Alt+Arrow (no prefix)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Pane navigation with prefix + vim keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with prefix + Shift+vim keys (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Vi-style copy mode
setw -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# ---------------------------------------------------------------------------
# Visual Styling
# ---------------------------------------------------------------------------

# Status bar
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=colour234 fg=colour137'

# Left status - session name
set -g status-left '#[fg=colour255,bg=colour62,bold] #S #[fg=colour62,bg=colour234] '
set -g status-left-length 30

# Right status - git branch, battery, date, time
set -g status-right '#[fg=colour114,bg=colour234]  #(cd #{pane_current_path} && git branch --show-current 2>/dev/null || echo "â€“") #[fg=colour234,bg=colour237] #[fg=colour222,bg=colour237] ðŸ”‹ #(pmset -g batt | grep -Eo "[0-9]+%%") #[fg=colour237,bg=colour241] #[fg=colour255,bg=colour241,bold] %d/%m #[fg=colour241,bg=colour245] #[fg=colour233,bg=colour245,bold] %H:%M '
set -g status-right-length 90

# Window status
setw -g window-status-current-style 'fg=colour81 bg=colour238 bold'
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '
setw -g window-status-style 'fg=colour138 bg=colour235'
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

# Pane borders
set -g pane-border-style 'fg=colour238'
set -g pane-active-border-style 'fg=colour81'

# Message styling
set -g message-style 'fg=colour232 bg=colour166 bold'

# ---------------------------------------------------------------------------
# TPM Plugins
# ---------------------------------------------------------------------------
# Install TPM: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Install plugins: prefix + I (capital I)

set -g @plugin 'tmux-plugins/tpm'

# Seamless Neovim/tmux navigation and resize
set -g @plugin 'aserowy/tmux.nvim'
set -g @tmux-nvim-navigation true
set -g @tmux-nvim-navigation-cycle false
set -g @tmux-nvim-navigation-keybinding-left 'C-h'
set -g @tmux-nvim-navigation-keybinding-down 'C-j'
set -g @tmux-nvim-navigation-keybinding-up 'C-k'
set -g @tmux-nvim-navigation-keybinding-right 'C-l'
set -g @tmux-nvim-resize true
set -g @tmux-nvim-resize-step-x 5
set -g @tmux-nvim-resize-step-y 5
set -g @tmux-nvim-resize-keybinding-left 'C-S-Left'
set -g @tmux-nvim-resize-keybinding-down 'C-S-Down'
set -g @tmux-nvim-resize-keybinding-up 'C-S-Up'
set -g @tmux-nvim-resize-keybinding-right 'C-S-Right'

# Session save/restore
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# macOS clipboard integration in copy mode
set -g @plugin 'tmux-plugins/tmux-yank'

# Initialize TPM (keep at very bottom)
run '~/.tmux/plugins/tpm/tpm'
